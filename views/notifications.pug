doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Notifications - MWF
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css", rel="stylesheet")
    link(rel="stylesheet", href="/css/attendant-manage.css")

    // Page-specific CSS
    style.
      /* Keep your CSS as is (I only cleaned spacing and organization) */
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --accent-color: #e74c3c;
        --light-color: #ecf0f1;
        --dark-color: #2c3e50;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        margin: 0;
        padding: 0;
        color: #333;
      }

      /* Notifications Layout */
      .notifications-page {
        padding: 30px;
        margin-left: 250px;
        margin-top: 80px;
        transition: all 0.3s ease;
        width: calc(100% - 250px);
        box-sizing: border-box;
        min-height: calc(100vh - 160px);
      }

      .sidebar.collapsed ~ .notifications-page {
        margin-left: 70px;
        width: calc(100% - 70px);
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 25px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--secondary-color);
      }

      /* Cards */
      .notifications-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .notification-card {
        border-bottom: 1px solid #e9ecef;
        padding: 20px 25px;
        transition: all 0.3s ease;
        background: white;
      }

      .notification-card.unread {
        border-left: 4px solid #3498db;
        background: linear-gradient(90deg, #f8f9fa 0%, white 10%);
      }

      .notification-card:hover {
        background-color: #f8f9fa;
        transform: translateX(5px);
      }

      .notification-type.stock_approval { background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb; }
      .notification-type.pending_sales { background: #fff3e0; color: #f57c00; border: 1px solid #ffe0b2; }
      .notification-type.offload_request { background: #e8f5e8; color: #388e3c; border: 1px solid #c8e6c9; }
      .notification-type.low_stock { background: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; }
      .notification-type.new_sale { background: #f3e5f5; color: #7b1fa2; border: 1px solid #e1bee7; }

      .notification-priority.high { background: #fff3e0; color: #f57c00; border: 1px solid #ffe0b2; }
      .notification-priority.medium { background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb; }
      .notification-priority.low { background: #f5f5f5; color: #616161; border: 1px solid #e0e0e0; }

      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #6c757d;
        background: white;
      }

  body
    // Sidebar
    aside.sidebar
      .logo-container
        img.logo-img(src="/images/logo 2.png", alt="MWF Logo")
        .logo-text Mayondo Wood & Furniture
      nav
        ul
          li: a(href="/manager-dashboard") i.fas.fa-home span Dashboard
          li: a(href="/reports") i.fas.fa-chart-bar span Reports
          li: a(href="/approve-stock") i.fas.fa-check-circle span Approve Stock
          li: a(href="/stock") i.fas.fa-boxes span Add Stock
          li: a(href="/sales-report") i.fas.fa-chart-line span Sales Reports
          li: a(href="/attendants") i.fas.fa-users span Attendants
          li: a(href="/loading/pending") i.fas.fa-clock span Pending Sales
          li: a(href="/assign-tasks") i.fas.fa-tasks span Assign Tasks
          li.active: a(href="/notifications") i.fas.fa-bell span Notifications
          li: a(href="/logout") i.fas.fa-sign-out-alt span Logout

    // Topbar
    #topbar
      .header-content
        .company-info
          h1 Notifications
          h3 Manage your notifications
        .user-profile
          img.profile-pic(src=(user && user.profileImage) ? user.profileImage : '/images/default-profile.png', alt="Profile")
          .user-info
            .user-name= user ? user.name : 'Manager'
            .user-role Manager

    // Main Page
    .notifications-page
      .page-header
        .header-text
          h1 i.fas.fa-bell  Notifications
          p View and manage all your notifications
        .page-actions
          if unreadCount > 0
            button.btn.btn-primary#markAllReadBtn
              i.fas.fa-check-double
              |  Mark All as Read
          a.btn.btn-outline-secondary(href="/manager-dashboard")
            i.fas.fa-arrow-left
            |  Back to Dashboard

      .notifications-container
        if notifications && notifications.length > 0
          each notification in notifications
            .notification-card(class=notification.status === 'unread' ? 'unread' : 'read', data-id=notification._id)
              .notification-header
                .notification-content
                  .notification-meta
                    span.notification-type(class=notification.type)= notification.type.replace('_', ' ').toUpperCase()
                    span.notification-priority(class=notification.priority)= notification.priority.toUpperCase()
                    span.status-badge(class=notification.status)= notification.status.replace('_', ' ').toUpperCase()
                  h3.notification-title= notification.title
                  p.notification-message= notification.message
                  .notification-time
                    i.fas.fa-clock
                    |  #{new Date(notification.createdAt).toLocaleString()}
                .notification-actions
                  if notification.status === 'unread'
                    button.btn.btn-sm.btn-success.mark-read-btn(data-id=notification._id)
                      i.fas.fa-check
                  if notification.actionUrl
                    a.btn.btn-sm.btn-primary(href=notification.actionUrl)
                      i.fas.fa-external-link-alt
        else
          .empty-state
            i.fas.fa-bell-slash
            h3 No Notifications
            p You're all caught up!

    footer
      .container
         p &copy; 2025 Mayondo Wood & Furniture Ltd 
         p Designed by A Rose Desire @ Groundbreaker Talents

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    script(src="/socket.io/socket.io.js")

    // JS Logic
    script.
      const socket = io();

      socket.on('new_notification', (notification) => {
        alert(`ðŸ”” ${notification.title}: ${notification.message}`);
        location.reload();
      });

      document.addEventListener('DOMContentLoaded', () => {
        // Mark single as read
        document.querySelectorAll('.mark-read-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            fetch(`/notifications/${id}/read`, { method: 'POST' })
              .then(res => res.json())
              .then(data => { if (data.success) location.reload(); });
          });
        });

        // Mark all as read
        const allBtn = document.getElementById('markAllReadBtn');
        if (allBtn) {
          allBtn.addEventListener('click', () => {
            fetch('/notifications/mark-all-read', { method: 'POST' })
              .then(res => res.json())
              .then(data => { if (data.success) location.reload(); });
          });
        }
      });
