//- notification-dropdown.pug
.notification-container
  .dropdown
    button.notification-bell.btn.btn-link.position-relative(
      type="button", 
      id="notificationDropdown", 
      data-bs-toggle="dropdown", 
      aria-expanded="false"
    )
      i.fas.fa-bell.fa-lg
      if unreadCount > 0
        span.position-absolute.top-0.start-100.translate-middle.badge.rounded-pill.bg-danger
          | #{unreadCount}
          span.visually-hidden unread notifications
    
    ul.dropdown-menu.dropdown-menu-end.notification-dropdown(aria-labelledby="notificationDropdown")
      li.dropdown-header
        .d-flex.justify-content-between.align-items-center
          span Notifications
          if unreadCount > 0
            button.btn.btn-sm.btn-outline-primary#markAllRead Mark all read
      
      if notifications && notifications.length > 0
        each notification in notifications
          li
            .notification-item(
              class=notification.status === 'unread' ? 'unread' : 'read',
              data-id=notification._id,
              onclick=notification.actionUrl ? `window.location.href='${notification.actionUrl}'` : ''
              style=notification.actionUrl ? 'cursor: pointer;' : ''
            )
              .d-flex.align-items-start
                .notification-icon(class=`priority-${notification.priority || 'medium'}`)
                  if notification.type === 'stock_approval'
                    i.fas.fa-boxes
                  else if notification.type === 'pending_sales'
                    i.fas.fa-truck-loading
                  else if notification.type === 'offload_request'
                    i.fas.fa-truck-moving
                  else if notification.type === 'low_stock'
                    i.fas.fa-exclamation-triangle
                  else if notification.type === 'new_sale'
                    i.fas.fa-shopping-cart
                  else if notification.type === 'task_completed'
                    i.fas.fa-tasks
                  else if notification.type === 'stock_approved'
                    i.fas.fa-check-circle
                  else if notification.type === 'stock_rejected'
                    i.fas.fa-times-circle
                  else
                    i.fas.fa-bell
                .notification-content.flex-grow-1
                  .d-flex.justify-content-between.align-items-start
                    div
                      p.mb-1.fw-bold= notification.title
                      p.mb-1.text-muted= notification.message
                      small.text-muted= new Date(notification.createdAt).toLocaleString()
                    if notification.status === 'unread'
                      button.btn.btn-sm.btn-outline-success.mark-read-btn(
                        data-id=notification._id, 
                        onclick="event.stopPropagation()"
                      )
                        i.fas.fa-check
      else
        li
          .text-center.py-3.text-muted
            | No notifications
      
      li
        .dropdown-footer.text-center.py-2.border-top
          a.text-decoration-none(href="/notifications") View all notifications