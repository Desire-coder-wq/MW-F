doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Attendant Dashboard - MWF
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(rel="stylesheet", href="/css/attendant-manage.css")
  body
    .layout
      // Sidebar
      aside.sidebar
        .logo-container
          img.logo-img(src="/images/logo 2.png", alt="MWF Logo")
          .logo-text Mayondo Wood & Furniture
        nav
          ul
            li
              a(href="/sales")
                i.fas.fa-cash-register
                span Record Sale
            li
              a(href="/sales-list")
                i.fas.fa-list-alt
                span Sales List
            li
              a(href="/attendant/add-stock")
                i.fas.fa-boxes
                span Add / Update Stock
            li
              a(href="/stockList")
                i.fas.fa-clipboard-list
                span Stock Inventory
            li
              a(href="/loading/offload")
                i.fas.fa-truck-loading
                span Offload Materials
            li
              a(href="/loading/pending")
                i.fas.fa-hourglass-half
                span Pending Sales
            li
              a(href="/attendant/tasks")
                i.fas.fa-tasks
                span My Tasks
            li
              a(href="/profile")
                i.fas.fa-user-circle
                span Profile
            li
              a(href="/settings")
                i.fas.fa-cogs
                span Settings
            li
              a(href="/logout")
                i.fas.fa-sign-out-alt
                span Logout

      // Topbar
      #topbar
        .header-content
          .company-info
            h1 Attendant Dashboard
            h3 Manage your daily tasks and operations
          .header-actions
            .notification-btn(onclick="toggleNotifications()")
              i.fas.fa-bell
              .notification-count#notificationCount 0
              #notificationDropdown.notification-dropdown
                .notification-header
                  h4 Notifications
                #notificationList
                  .notification-item
                    .notification-title No new notifications
            .user-profile
              i.fas.fa-user-circle
              span#attendantName Attendant

      // Main Content
      .container
        .cards
          .card(onclick="location.href='/sales'")
            .card-icon
              i.fas.fa-cash-register
            .card-content
              h4 Record Sale
              p Enter new sales transactions
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/sales-list'")
            .card-icon
              i.fas.fa-list-alt
            .card-content
              h4 Sales List
              p View all recorded sales
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/attendant/add-stock'")
            .card-icon
              i.fas.fa-boxes
            .card-content
              h4 Add / Update Stock
              p Manage stock quantities
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/stockList'")
            .card-icon
              i.fas.fa-clipboard-list
            .card-content
              h4 Stock Inventory
              p Check available stock
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/attendant/tasks'")
            .card-icon
              i.fas.fa-tasks
            .card-content
              h4 My Tasks
              p View assigned tasks
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/loading/offload'")
            .card-icon
              i.fas.fa-truck-loading
            .card-content
              h4 Offload Materials
              p Offload incoming stock
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/loading/pending'")
            .card-icon
              i.fas.fa-hourglass-half
            .card-content
              h4 Pending Sales
              p Manage pending orders
            .card-action
              button.go-btn Go

          .card(onclick="location.href='/profile'")
            .card-icon
              i.fas.fa-user-circle
            .card-content
              h4 Profile
              p Manage your account settings
            .card-action
              button.go-btn Go

    // Footer
    footer
      .container
        p Â© 2025 Mayondo Wood & Furniture Ltd

  script.
    document.addEventListener('DOMContentLoaded', function() {
      const attendantName = '#{user ? user.name : "Attendant"}';
      document.getElementById('attendantName').textContent = attendantName;
      loadNotifications();
    });

    function toggleNotifications() {
      const dropdown = document.getElementById('notificationDropdown');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    async function loadNotifications() {
      try {
        const response = await fetch('/attendant/tasks');
        const tasks = await response.json();
        const list = document.getElementById('notificationList');
        const count = document.getElementById('notificationCount');

        if (tasks && tasks.length > 0) {
          const active = tasks.filter(t => t.status !== 'completed');
          count.textContent = active.length;
          list.innerHTML = '';
          active.forEach(task => {
            const item = document.createElement('div');
            item.className = 'notification-item unread';
            item.innerHTML = `
              <div class="notification-title">${task.taskType}</div>
              <div class="notification-message">${task.taskDescription}</div>
              <div class="notification-time">Due: ${new Date(task.dueDate).toLocaleDateString()}</div>
            `;
            item.onclick = () => (window.location.href = '/attendant/tasks');
            list.appendChild(item);
          });
        } else {
          count.textContent = '0';
          list.innerHTML = `<div class="notification-item"><div class="notification-title">No new notifications</div></div>`;
        }
      } catch (err) {
        console.error('Error loading notifications:', err);
      }
    }

    document.addEventListener('click', e => {
      const btn = document.querySelector('.notification-btn');
      const dropdown = document.getElementById('notificationDropdown');
      if (!btn.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });
