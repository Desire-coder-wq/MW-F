doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title= title
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(rel="stylesheet", href="/css/customer.css")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js")

  body
    .layout
      aside.sidebar
        .logo-container
          img.logo-img(src="/images/logo 2.png", alt="MWF Logo")
          .logo-text Mayondo Wood & Furniture
          button.hamburger-menu#sidebarToggle
            .hamburger-line
            .hamburger-line
            .hamburger-line
        nav
          ul
            li
              a(href="/stockList")
                i.fas.fa-boxes
                span Stock
            li
              a(href="/suppliers", class="active")
                i.fas.fa-truck
                span Suppliers
            li
              a(href="/customers")
                i.fas.fa-users
                span Customers
            li
              a(href="/logout")
                i.fas.fa-sign-out-alt
                span Logout

      .main-content
        #topbar
          .header-content
            .company-info
              h1 Suppliers Dashboard
              h3 Manage and view suppliers
            .header-actions
              a.back-btn(href="/manager-dashboard")
                i.fas.fa-arrow-left
                | Back to Dashboard
              .notification-btn#notificationBtn
                i.fas.fa-bell
                .notification-count 3

        .container
          .suppliers-header
            .header-text
              h1 Suppliers Information
              p Here are all suppliers automatically captured from stock entries.
            .supplier-actions
              button.export-btn#exportPdf
                i.fas.fa-download
                | Export to PDF

          .supplier-stats
            .supplier-stat-card
              .supplier-stat-icon(style="background: #dcfce7; color: #166534;")
                i.fas.fa-truck
              .supplier-stat-info
                h3 #{suppliers.length}
                p Total Suppliers
            .supplier-stat-card
              .supplier-stat-icon(style="background: #fef3c7; color: #92400e;")
                i.fas.fa-envelope
              .supplier-stat-info
                h3 #{suppliersWithEmail}
                p With Email
            .supplier-stat-card
              .supplier-stat-icon(style="background: #dcfce7; color: #166534;")
                i.fas.fa-phone
              .supplier-stat-info
                h3 #{suppliersWithContact}
                p With Contact
            .supplier-stat-card
              .supplier-stat-icon(style="background: #fef3c7; color: #92400e;")
                i.fas.fa-map-marker-alt
              .supplier-stat-info
                h3 #{suppliersWithAddress}
                p With Address

          .table-section
            .table-container
              table.suppliers-table
                thead
                  tr
                    th 
                      i.fas.fa-user
                      | Supplier Name
                    th 
                      i.fas.fa-envelope
                      | Email
                    th 
                      i.fas.fa-phone
                      | Contact
                    th 
                      i.fas.fa-map-marker-alt
                      | Address
                    th 
                      i.fas.fa-calendar
                      | Date Added
                    th 
                      i.fas.fa-cog
                      | Actions
                tbody
                  each supplier in suppliers
                    tr
                      td= supplier.name
                      td= supplier.email || '-'
                      td= supplier.contact || '-'
                      td= supplier.address || '-'
                      td= supplier.dateAdded.toDateString()
                      td.actions-cell
                        form.delete-form(action=`/suppliers/${supplier._id}/delete`, method="POST")
                          button.btn-delete(type="submit")
                            i.fas.fa-trash
                            | Delete

        footer
          .container
            p &copy; 2025 Mayondo Wood & Furniture Ltd

    script.
      // Calculate supplier statistics
      const suppliers = !{JSON.stringify(suppliers)};
      const suppliersWithEmail = suppliers.filter(s => s.email && s.email !== '-').length;
      const suppliersWithContact = suppliers.filter(s => s.contact && s.contact !== '-').length;
      const suppliersWithAddress = suppliers.filter(s => s.address && s.address !== '-').length;

      // Update statistics in the DOM
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('.supplier-stat-info h3')[0].textContent = suppliers.length;
        document.querySelectorAll('.supplier-stat-info h3')[1].textContent = suppliersWithEmail;
        document.querySelectorAll('.supplier-stat-info h3')[2].textContent = suppliersWithContact;
        document.querySelectorAll('.supplier-stat-info h3')[3].textContent = suppliersWithAddress;

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');

        sidebarToggle.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          mainContent.classList.toggle('expanded');
        });

        // PDF Export functionality
        const exportPdfBtn = document.getElementById('exportPdf');
        exportPdfBtn.addEventListener('click', exportToPdf);

        function exportToPdf() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          
          // Add title
          doc.setFontSize(20);
          doc.text('Suppliers Report - Mayondo Wood & Furniture', 14, 15);
          
          // Add date
          doc.setFontSize(10);
          doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 22);
          
          // Add statistics
          doc.setFontSize(12);
          doc.text(`Total Suppliers: ${suppliers.length}`, 14, 32);
          doc.text(`Suppliers with Email: ${suppliersWithEmail}`, 14, 38);
          doc.text(`Suppliers with Contact: ${suppliersWithContact}`, 14, 44);
          doc.text(`Suppliers with Address: ${suppliersWithAddress}`, 14, 50);
          
          // Add table headers
          let yPosition = 65;
          doc.setFontSize(10);
          doc.setFont(undefined, 'bold');
          doc.text('Name', 14, yPosition);
          doc.text('Email', 50, yPosition);
          doc.text('Contact', 90, yPosition);
          doc.text('Address', 130, yPosition);
          doc.text('Date Added', 170, yPosition);
          
          yPosition += 8;
          doc.setFont(undefined, 'normal');
          
          // Add supplier data
          suppliers.forEach((supplier, index) => {
            if (yPosition > 270) {
              doc.addPage();
              yPosition = 20;
            }
            
            doc.text(supplier.name || '-', 14, yPosition);
            doc.text(supplier.email || '-', 50, yPosition);
            doc.text(supplier.contact || '-', 90, yPosition);
            doc.text(supplier.address || '-', 130, yPosition);
            doc.text(supplier.dateAdded ? new Date(supplier.dateAdded).toLocaleDateString() : '-', 170, yPosition);
            
            yPosition += 6;
          });
          
          // Save the PDF
          doc.save(`suppliers_report_${new Date().toISOString().split('T')[0]}.pdf`);
        }
      });