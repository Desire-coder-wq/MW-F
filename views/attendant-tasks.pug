doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title My Tasks - MWF
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(rel="stylesheet", href="/css/attendant-manage.css")
    style.
      .table-section {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }
      .table-header h3 {
        color: #2c5aa0;
        margin: 0;
      }
      .table-container {
        overflow-x: auto;
      }
      .tasks-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .tasks-table th {
        background: #2c5aa0;
        color: white;
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
      }
      .tasks-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #e0e0e0;
      }
      .tasks-table tr:hover {
        background: #f8f9fa;
      }
      .status-pending {
        background: #fff3cd;
        color: #856404;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }
      .status-in-progress {
        background: #cce7ff;
        color: #004085;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }
      .status-completed {
        background: #d4edda;
        color: #155724;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }
      .priority-high {
        color: #dc3545;
        font-weight: bold;
      }
      .priority-medium {
        color: #ffc107;
        font-weight: bold;
      }
      .priority-low {
        color: #28a745;
        font-weight: bold;
      }
      .btn-update {
        background: #2c5aa0;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .btn-update:hover {
        background: #1e3d6f;
      }
      .no-data {
        text-align: center;
        padding: 40px;
        color: #666;
      }
      .no-data i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #ddd;
      }

  body
    .layout
      //- Sidebar
      aside.sidebar
        .logo-container
          img.logo-img(src="/images/logo 2.png", alt="MWF Logo")
          .logo-text Mayondo Wood & Furniture
        nav
          ul
            li
              a(href="/sales")
                i.fas.fa-cash-register
                span Record Sale
            li
              a(href="/sales-list")
                i.fas.fa-list-alt
                span Sales List
            li
              a(href="/attendant/add-stock")
                i.fas.fa-boxes
                span Add / Update Stock
            li
              a(href="/stockList")
                i.fas.fa-clipboard-list
                span Stock Inventory
            li
              a(href="/sales-summary")
                i.fas.fa-chart-bar
                span Sales Summary
            li
              a(href="/attendant/tasks", class="active")
                i.fas.fa-tasks
                span My Tasks
            li
              a(href="/loading/offload")
                i.fas.fa-truck-loading
                span Offload Materials
            li
              a(href="/loading/pending")
                i.fas.fa-hourglass-half
                span Pending Sales
            li
              a(href="/logout")
                i.fas.fa-sign-out-alt
                span Logout

      //- Topbar
      #topbar
        .header-content
          .company-info
            h1 My Tasks
            h3 View and manage your assigned tasks
          .header-actions
            .notification-btn
              i.fas.fa-bell
              .notification-count 0
            .user-profile
              i.fas.fa-user-circle
              span#attendantName Attendant

      //- Main Content
      .container
        .table-section
          .table-header
            h3
              i.fas.fa-tasks
              | My Assigned Tasks
          .table-container
            if tasks && tasks.length
              table.tasks-table
                thead
                  tr
                    th 
                      i.fas.fa-tasks
                      | Task Type
                    th 
                      i.fas.fa-align-left
                      | Description
                    th 
                      i.fas.fa-flag
                      | Priority
                    th 
                      i.fas.fa-calendar
                      | Due Date
                    th 
                      i.fas.fa-check-circle
                      | Status
                    th 
                      i.fas.fa-cog
                      | Actions
                tbody
                  each task in tasks
                    tr
                      td= task.taskType
                      td= task.taskDescription
                      td(class=`priority-${task.priority}`)= task.priority
                      td= new Date(task.dueDate).toLocaleDateString()
                      td
                        span(class=`status-${task.status}`)= task.status
                      td
                        if task.status === 'pending'
                          form(action=`/tasks/${task._id}/update-status`, method="POST", style="display: inline;")
                            input(type="hidden", name="status", value="in progress")
                            button.btn-update(type="submit")
                              i.fas.fa-play
                              | Start
                        else if task.status === 'in progress'
                          form(action=`/tasks/${task._id}/update-status`, method="POST", style="display: inline;")
                            input(type="hidden", name="status", value="completed")
                            button.btn-update(type="submit")
                              i.fas.fa-check
                              | Complete
                        else
                          span.status-completed Completed
            else
              .no-data
                i.fas.fa-clipboard-list
                p No tasks assigned yet.

    //- Footer
    footer
      .container
        p &copy; 2025 Mayondo Wood & Furniture Ltd

  script.
    // Set attendant name if available
    document.addEventListener('DOMContentLoaded', function() {
      const attendantName = '#{user ? user.name : "Attendant"}';
      document.getElementById('attendantName').textContent = attendantName;
    });